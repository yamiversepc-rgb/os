#include <stdio.h> 

#include <stdlib.h> 

#include <pthread.h> 

#include <unistd.h> 

 

#define NUM_PHILOSOPHERS 5 

#define NUM_MEALS 3 

 

pthread_mutex_t forks[NUM_PHILOSOPHERS]; 

 

void* philosopher(void* num) { 

    int id = *((int*)num); 

    int left_fork = id; 

    int right_fork = (id + 1) % NUM_PHILOSOPHERS; 

 

    for (int meal = 0; meal < NUM_MEALS; meal++) { 

        printf("Philosopher %d is thinking...\n", id); 

        sleep(1); 

 

        // Picking up forks 

        pthread_mutex_lock(&forks[left_fork]); 

        pthread_mutex_lock(&forks[right_fork]); 

        printf("Philosopher %d is eating (meal %d)...\n", id, meal + 1); 

        sleep(2); 

 

        // Putting down forks 

        pthread_mutex_unlock(&forks[right_fork]); 

        pthread_mutex_unlock(&forks[left_fork]); 

        printf("Philosopher %d finished eating meal %d.\n", id, meal + 1); 

    } 

 

    pthread_exit(NULL); 

} 

 

int main() { 

    pthread_t philosophers[NUM_PHILOSOPHERS]; 

    int ids[NUM_PHILOSOPHERS]; 

 

    // Initialize mutexes 

    for (int i = 0; i < NUM_PHILOSOPHERS; i++) { 

        pthread_mutex_init(&forks[i], NULL); 

        ids[i] = i; 

    } 

 

    // Creating philosopher threads 

    for (int i = 0; i < NUM_PHILOSOPHERS; i++) { 

        pthread_create(&philosophers[i], NULL, philosopher, &ids[i]); 

    } 

 

    // Wait for all threads to complete 

    for (int i = 0; i < NUM_PHILOSOPHERS; i++) { 

        pthread_join(philosophers[i], NULL); 

    } 

 

    // Destroy mutexes 

    for (int i = 0; i < NUM_PHILOSOPHERS; i++) { 

        pthread_mutex_destroy(&forks[i]); 

    } 

 

    printf("All philosophers have finished their meals.\n"); 

 

    return 0; 

}    