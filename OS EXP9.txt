#include <stdio.h> 

#include <sys/ipc.h> 

#include <sys/shm.h> 

#include <sys/types.h> 

#include <unistd.h> 

#include <string.h> 

 

int main() { 

    int shmid; 

    char *shared_memory; 

 

    // Create shared memory segment 

    shmid = shmget((key_t)1122, 1024, 0666 | IPC_CREAT); 

    if (shmid == -1) { 

        printf("Shared memory creation failed\n"); 

        return 1; 

    } 

 

    // Fork a child process 

    if (fork() == 0) { 

        // Child Process: Read from shared memory 

        sleep(2); // wait for parent to write 

        shared_memory = shmat(shmid, NULL, 0); 

 

        printf("Child Process Read: %s\n", shared_memory); 

        shmdt(shared_memory); 

 

    } else { 

        // Parent Process: Write to shared memory 

        shared_memory = shmat(shmid, NULL, 0); 

 

        char message[] = "Hello from Parent via Shared Memory!"; 

        strcpy(shared_memory, message); 

 

        printf("Parent Process Wrote: %s\n", message); 

        shmdt(shared_memory); 

 

        wait(NULL); 

        shmctl(shmid, IPC_RMID, NULL);  // Delete shared memory 

    } 

    return 0; 

}  